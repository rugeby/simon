{"ast":null,"code":"import _regeneratorRuntime from\"/Users/liruge/Desktop/simon/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/liruge/Desktop/simon/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _createClass from\"/Users/liruge/Desktop/simon/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _classCallCheck from\"/Users/liruge/Desktop/simon/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";var GameEvent={System:'system',End:'gameEnd',Start:'gameStart'};var EventMessage=/*#__PURE__*/_createClass(function EventMessage(from,type,value){_classCallCheck(this,EventMessage);this.from=from;this.type=type;this.value=value;});var GameEventNotifier=/*#__PURE__*/function(){function GameEventNotifier(){var _this=this;_classCallCheck(this,GameEventNotifier);this.events=[];this.handlers=[];// When dev debugging we need to talk to the service and not the React debugger\nvar port=window.location.port;if(process.env.NODE_ENV!=='production'){port=3000;}var protocol=window.location.protocol==='http:'?'ws':'wss';this.socket=new WebSocket(\"\".concat(protocol,\"://\").concat(window.location.hostname,\":\").concat(port,\"/ws\"));this.socket.onopen=function(event){_this.receiveEvent(new EventMessage('Simon',GameEvent.System,{msg:'connected'}));};this.socket.onclose=function(event){_this.receiveEvent(new EventMessage('Simon',GameEvent.System,{msg:'disconnected'}));};this.socket.onmessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(msg){var event;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.t0=JSON;_context.next=4;return msg.data.text();case 4:_context.t1=_context.sent;event=_context.t0.parse.call(_context.t0,_context.t1);_this.receiveEvent(event);_context.next=11;break;case 9:_context.prev=9;_context.t2=_context[\"catch\"](0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function(_x){return _ref.apply(this,arguments);};}();}_createClass(GameEventNotifier,[{key:\"broadcastEvent\",value:function broadcastEvent(from,type,value){var event=new EventMessage(from,type,value);this.socket.send(JSON.stringify(event));}},{key:\"addHandler\",value:function addHandler(handler){this.handlers.push(handler);}},{key:\"removeHandler\",value:function removeHandler(handler){this.handlers.filter(function(h){return h!==handler;});}},{key:\"receiveEvent\",value:function receiveEvent(event){var _this2=this;this.events.push(event);this.events.forEach(function(e){_this2.handlers.forEach(function(handler){handler(e);});});}}]);return GameEventNotifier;}();var GameNotifier=new GameEventNotifier();export{GameEvent,GameNotifier};","map":{"version":3,"names":["GameEvent","System","End","Start","EventMessage","from","type","value","GameEventNotifier","events","handlers","port","window","location","process","env","NODE_ENV","protocol","socket","WebSocket","hostname","onopen","event","receiveEvent","msg","onclose","onmessage","JSON","data","text","parse","send","stringify","handler","push","filter","h","forEach","e","GameNotifier"],"sources":["/Users/liruge/Desktop/simon/src/play/gameNotifier.js"],"sourcesContent":["const GameEvent = {\n  System: 'system',\n  End: 'gameEnd',\n  Start: 'gameStart',\n};\n\nclass EventMessage {\n  constructor(from, type, value) {\n    this.from = from;\n    this.type = type;\n    this.value = value;\n  }\n}\n\nclass GameEventNotifier {\n  events = [];\n  handlers = [];\n\n  constructor() {\n    // When dev debugging we need to talk to the service and not the React debugger\n    let port = window.location.port;\n    if (process.env.NODE_ENV !== 'production') {\n      port = 3000;\n    }\n\n    const protocol = window.location.protocol === 'http:' ? 'ws' : 'wss';\n    this.socket = new WebSocket(`${protocol}://${window.location.hostname}:${port}/ws`);\n    this.socket.onopen = (event) => {\n      this.receiveEvent(new EventMessage('Simon', GameEvent.System, { msg: 'connected' }));\n    };\n    this.socket.onclose = (event) => {\n      this.receiveEvent(new EventMessage('Simon', GameEvent.System, { msg: 'disconnected' }));\n    };\n    this.socket.onmessage = async (msg) => {\n      try {\n        const event = JSON.parse(await msg.data.text());\n        this.receiveEvent(event);\n      } catch {}\n    };\n  }\n\n  broadcastEvent(from, type, value) {\n    const event = new EventMessage(from, type, value);\n    this.socket.send(JSON.stringify(event));\n  }\n\n  addHandler(handler) {\n    this.handlers.push(handler);\n  }\n\n  removeHandler(handler) {\n    this.handlers.filter((h) => h !== handler);\n  }\n\n  receiveEvent(event) {\n    this.events.push(event);\n\n    this.events.forEach((e) => {\n      this.handlers.forEach((handler) => {\n        handler(e);\n      });\n    });\n  }\n}\n\nconst GameNotifier = new GameEventNotifier();\nexport { GameEvent, GameNotifier };\n"],"mappings":"kdAAA,GAAMA,UAAS,CAAG,CAChBC,MAAM,CAAE,QAAQ,CAChBC,GAAG,CAAE,SAAS,CACdC,KAAK,CAAE,WACT,CAAC,CAAC,GAEIC,aAAY,2BAChB,sBAAYC,IAAI,CAAEC,IAAI,CAAEC,KAAK,CAAE,oCAC7B,IAAI,CAACF,IAAI,CAAGA,IAAI,CAChB,IAAI,CAACC,IAAI,CAAGA,IAAI,CAChB,IAAI,CAACC,KAAK,CAAGA,KAAK,CACpB,CAAC,KAGGC,kBAAiB,yBAIrB,4BAAc,6DAHdC,MAAM,CAAG,EAAE,MACXC,QAAQ,CAAG,EAAE,CAGX;AACA,GAAIC,KAAI,CAAGC,MAAM,CAACC,QAAQ,CAACF,IAAI,CAC/B,GAAIG,OAAO,CAACC,GAAG,CAACC,QAAQ,GAAK,YAAY,CAAE,CACzCL,IAAI,CAAG,IAAI,CACb,CAEA,GAAMM,SAAQ,CAAGL,MAAM,CAACC,QAAQ,CAACI,QAAQ,GAAK,OAAO,CAAG,IAAI,CAAG,KAAK,CACpE,IAAI,CAACC,MAAM,CAAG,GAAIC,UAAS,WAAIF,QAAQ,eAAML,MAAM,CAACC,QAAQ,CAACO,QAAQ,aAAIT,IAAI,QAAM,CACnF,IAAI,CAACO,MAAM,CAACG,MAAM,CAAG,SAACC,KAAK,CAAK,CAC9B,KAAI,CAACC,YAAY,CAAC,GAAInB,aAAY,CAAC,OAAO,CAAEJ,SAAS,CAACC,MAAM,CAAE,CAAEuB,GAAG,CAAE,WAAY,CAAC,CAAC,CAAC,CACtF,CAAC,CACD,IAAI,CAACN,MAAM,CAACO,OAAO,CAAG,SAACH,KAAK,CAAK,CAC/B,KAAI,CAACC,YAAY,CAAC,GAAInB,aAAY,CAAC,OAAO,CAAEJ,SAAS,CAACC,MAAM,CAAE,CAAEuB,GAAG,CAAE,cAAe,CAAC,CAAC,CAAC,CACzF,CAAC,CACD,IAAI,CAACN,MAAM,CAACQ,SAAS,4FAAG,iBAAOF,GAAG,0JAEhBG,IAAI,uBAAaH,IAAG,CAACI,IAAI,CAACC,IAAI,EAAE,kCAAxCP,KAAK,aAAQQ,KAAK,+BACxB,KAAI,CAACP,YAAY,CAACD,KAAK,CAAC,CAAC,mJAE5B,+DACH,CAAC,4DAED,wBAAejB,IAAI,CAAEC,IAAI,CAAEC,KAAK,CAAE,CAChC,GAAMe,MAAK,CAAG,GAAIlB,aAAY,CAACC,IAAI,CAAEC,IAAI,CAAEC,KAAK,CAAC,CACjD,IAAI,CAACW,MAAM,CAACa,IAAI,CAACJ,IAAI,CAACK,SAAS,CAACV,KAAK,CAAC,CAAC,CACzC,CAAC,0BAED,oBAAWW,OAAO,CAAE,CAClB,IAAI,CAACvB,QAAQ,CAACwB,IAAI,CAACD,OAAO,CAAC,CAC7B,CAAC,6BAED,uBAAcA,OAAO,CAAE,CACrB,IAAI,CAACvB,QAAQ,CAACyB,MAAM,CAAC,SAACC,CAAC,QAAKA,EAAC,GAAKH,OAAO,GAAC,CAC5C,CAAC,4BAED,sBAAaX,KAAK,CAAE,iBAClB,IAAI,CAACb,MAAM,CAACyB,IAAI,CAACZ,KAAK,CAAC,CAEvB,IAAI,CAACb,MAAM,CAAC4B,OAAO,CAAC,SAACC,CAAC,CAAK,CACzB,MAAI,CAAC5B,QAAQ,CAAC2B,OAAO,CAAC,SAACJ,OAAO,CAAK,CACjCA,OAAO,CAACK,CAAC,CAAC,CACZ,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,CAAC,iCAGH,GAAMC,aAAY,CAAG,GAAI/B,kBAAiB,EAAE,CAC5C,OAASR,SAAS,CAAEuC,YAAY"},"metadata":{},"sourceType":"module","externalDependencies":[]}